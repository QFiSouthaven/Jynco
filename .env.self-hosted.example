# Video Foundry - Self-Hosted Production Mode Configuration
# ==========================================================
# This configuration is for SINGLE-TENANT ENTERPRISE deployments
# Balanced security with administrative flexibility

# Execution Mode (REQUIRED)
JYNCO_EXECUTION_MODE=self-hosted-production

# ============================================================================
# SECRETS MANAGEMENT (REQUIRED in self-hosted-production)
# ============================================================================
VAULT_ADDR=https://vault.internal
VAULT_TOKEN=hvs.XXXXXXXXXXXXXXXXXXXXXXXX
# Or use AppRole authentication:
# VAULT_ROLE_ID=xxxxx-xxxxx-xxxxx
# VAULT_SECRET_ID=xxxxx-xxxxx-xxxxx

# ============================================================================
# DATABASE (REQUIRED)
# ============================================================================
DATABASE_URL=postgresql://user:password@postgres.internal:5432/videofoundry
ENABLE_DATABASE_RLS=true  # REQUIRED for multi-user deployments

# ============================================================================
# CACHE & MESSAGE QUEUE (REQUIRED)
# ============================================================================
REDIS_URL=redis://redis.internal:6379/0
RABBITMQ_URL=amqp://user:password@rabbitmq.internal:5672/

# ============================================================================
# STORAGE (Flexible - choose cloud or local)
# ============================================================================
# Option 1: Cloud Storage (Recommended)
STORAGE_TYPE=s3
S3_BUCKET=video-foundry-selfhosted
AWS_ACCESS_KEY_ID=AKIAXXXXXXXXX
AWS_SECRET_ACCESS_KEY=xxxxxxxxxxxxxxxxxx
AWS_REGION=us-east-1

# Option 2: Local Storage (with warning)
# STORAGE_TYPE=local
# LOCAL_STORAGE_PATH=/var/lib/videofoundry/videos
# NOTE: Ensure proper backup procedures if using local storage!

# ============================================================================
# IAM / AUTHENTICATION (REQUIRED in self-hosted-production)
# ============================================================================
OIDC_PROVIDER_URL=https://auth.internal
OIDC_CLIENT_ID=video-foundry
OIDC_CLIENT_SECRET=xxxxxxxxxxxxxxxxxx
OIDC_REDIRECT_URI=https://videofoundry.internal/auth/callback

# Alternative: LDAP/Active Directory
# AUTH_TYPE=ldap
# LDAP_SERVER=ldap://ldap.internal:389
# LDAP_BIND_DN=cn=admin,dc=example,dc=com
# LDAP_BIND_PASSWORD=password

# Session Management
SECRET_KEY=CHANGE-THIS-TO-A-SECURE-RANDOM-STRING
SESSION_TIMEOUT=3600  # 1 hour

# ============================================================================
# SECURITY CONTROLS
# ============================================================================

# Sandboxing (REQUIRED: gvisor or firecracker)
SANDBOX_TYPE=gvisor
# SANDBOX_TYPE=firecracker

# Network Policy (Restricted to approved sources)
NETWORK_EGRESS=restricted
EGRESS_PROXY_URL=http://proxy.internal:3128

# Approved Resources (Admin-configurable)
APPROVED_GIT_REPOS=github.com/your-org/*,gitlab.internal/*
APPROVED_MODEL_SOURCES=huggingface.co/your-org/*,models.internal/*

# Workflow Vetting (Admin-configurable allow-list)
WORKFLOW_VETTING_STRICT=false  # Allows admin-approved resources
ADMIN_APPROVED_NODES_FILE=/etc/videofoundry/approved_nodes.json

# Audit Logging
ENABLE_AUDIT_LOGGING=true
AUDIT_LOG_PATH=/var/log/videofoundry/audit.log

# ============================================================================
# APPLICATION
# ============================================================================
ENVIRONMENT=self-hosted-production
CORS_ORIGINS=https://videofoundry.internal
LOG_LEVEL=INFO

# ============================================================================
# AI SERVICES
# ============================================================================
# Cloud AI providers (optional)
RUNWAY_API_KEY=your_runway_key_here
STABILITY_API_KEY=your_stability_key_here

# ComfyUI (local or internal)
COMFYUI_URL=http://comfyui.internal:8188

# ============================================================================
# MONITORING (Recommended)
# ============================================================================
PROMETHEUS_ENABLED=true
PROMETHEUS_PORT=9090

# Internal metrics endpoint
METRICS_ENDPOINT=http://metrics.internal

# ============================================================================
# NOTES FOR ADMINISTRATORS
# ============================================================================
# - Secrets vault (Vault/AWS Secrets Manager) is REQUIRED
# - IAM/Authentication is REQUIRED for multi-user environments
# - You can choose between cloud (S3) or local storage
# - Configure approved Git repos and model sources for your organization
# - Review approved resources regularly via admin UI
# - Set up backup procedures, especially if using local storage
# - Monitor audit logs for security events
# - Keep approved_nodes.json updated with your organization's trusted resources
